<!DOCTYPE html>
<html>
  <head>
    <title>People&Roads</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
     <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
    <script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC6UyUT2h5LiCC2ClU7WUqoQSGq5EPQOSQ&callback=initMap&libraries=&v=weekly"
      defer
    ></script>
    <script src="https://api-maps.yandex.ru/2.1/?lang=en_RU&amp;apikey=599d40fb-71b4-47be-b424-072f354f7bb7" type="text/javascript"></script>
      <script type="text/javascript" src="geopoint.js"></script>



    <style type="text/css">

      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 100%;
      }

      /* Optional: Makes the sample page fill the window. */
      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
    <script>
      const Struct = (...keys) => ((...v) => keys.reduce((o, k, i) => {o[k] = v[i]; return o} , {}))
      const Item = Struct('marker', 'x', 'y', 'speed')
      var people = [];


      function randomInRange(min, max) {
        return Math.random() < 0.5 ? ((1-Math.random()) * (max-min) + min) : (Math.random() * (max-min) + min);
      } 


      function randomizeInteger(min, max) {
        if(max == null) {
          max = (min == null ? Number.MAX_SAFE_INTEGER : min);
          min = 0;
        }
        min = Math.ceil(min);  // inclusive min
        max = Math.floor(max); // exclusive max
        if(min > max - 1) {
          throw new Error("Incorrect arguments.");
        }
        return min + Math.floor((max - min) * Math.random());
      }


      function setNewPosition(marker, x, y){
        var latlng = new google.maps.LatLng(x, y);
        marker.setPosition(latlng);
      }


      function changeMarkerPosition(marker, x, y, speed, direction) {
        switch(direction){
          case 1: //right
            setNewPosition(marker, x+speed, y);
            break;
          case 2: //left
            setNewPosition(marker, x-speed, y);
            break;
          case 3: //up
            setNewPosition(marker, x, y+speed);
            break;
          case 4: //down
            setNewPosition(marker, x, y-speed);
            break;
        }
      }
//https://maps.googleapis.com/maps/api/geocode/json?latlng=широта,долгота&key=ВашКлюч
//https://api-maps.yandex.ru/2.1/?lang=en_RU&amp;apikey=OAU9O3HthXtLZDvg5sx~x5n0dULWAPs0qAcCN07W7GOxl-OB26XKy4ONrE1WUcXQw8tZm0Gw1~qZBxJlGUjXT3lKZdg0Nusvpx6m3jNpLh8
//https://geocode-maps.yandex.ru/1.x/?geocode=27.525773,53.89079&kind=locality 
//       function getMAP(){
//         $.get("https://geocode-maps.yandex.ru/1.x/?geocode=27.525773,53.89079&kind=localit",function(data) {
//           console.log("hello yep");
// console.log(data);
            
//                }, "json");



/**
*МОй ключ яндекс 599d40fb-71b4-47be-b424-072f354f7bb7
Катин 197f1a96-6ccc-4845-aa21-7bd5de550213
**/


//         }
function getRoadapi (){
  //https://roads.googleapis.com/v1/snapToRoads?parameters&key=
 // https://roads.googleapis.com/v1/snapToRoads?path=27.525773,53.89079&interpolate=false&key=AIzaSyC6UyUT2h5LiCC2ClU7WUqoQSGq5EPQOSQ
  //$.get(" https://roads.googleapis.com/v1/snapToRoads?path=27.525773,53.89079&interpolate=false&key=AIzaSyC6UyUT2h5LiCC2ClU7WUqoQSGq5EPQOSQ",function(data) {
//           console.log("hello yep");
// console.log(data);
            
//                }, "json");

}
//TODO
                            // .GeoObjectCollection.featureMember[0].GeoObject.metaDataProperty.GeocoderMetaData.kind
 function getMAP(temp){
     let URL = "https://geocode-maps.yandex.ru/1.x/?apikey=599d40fb-71b4-47be-b424-072f354f7bb7&geocode=" ;
     let x = temp[0].replace(/ /g, "").replace("'", "%27");   
     // https://geocode-maps.yandex.ru/1.x/?apikey=197f1a96-6ccc-4845-aa21-7bd5de550213&geocode=55°01%2715.0%22N%2082°57%2721.9%22E&format=json",function(data) {
      x=x.concat("N");
      
     let y = temp[1].replace(/ /g, "").replace("'", "%27");
     
      y=y.concat("E");
     let format ="&format=json";
//55°01%2715.0%22N%20, 82°57%2721.9%22E"
    // let xx = "56°01'55.7"N 92°49'19.7"E"; 56°01%2755.7"N%2092°49%2719.7"E
   // https://geocode-maps.yandex.ru/1.x/?apikey=197f1a96-6ccc-4845-aa21-7bd5de550213&geocode=55°01%2715.0%22N%2082°57%2721.9%22E&format=json",function(data) {
//           
    let URL1 = URL.concat(x,"%20",y,format);
     console.log(x);
     console.log(y);
     console.log(URL1);
     $.get(URL1,function(data) {
//          
     // $.get("https://geocode-maps.yandex.ru/1.x/?apikey=197f1a96-6ccc-4845-aa21-7bd5de550213&geocode=&format=json?" + $.param({geocode: "55°01%2715.0%22N%20, 82°57%2721.9%22E"}) ,function(data) {
        let way = data.response.GeoObjectCollection.featureMember[0].GeoObject.metaDataProperty.GeocoderMetaData.kind
                 console.log(data.response.GeoObjectCollection.featureMember[0].GeoObject.metaDataProperty.GeocoderMetaData.kind);
                   }, "json");
        // Выбираем первый результат геокодирования.
             //  var firstGeoObject = data.geoObjects.get(0),
             //    kind = firstGeoObject.properties.get('metaDataProperty.GeocoderMetaData.kind'),
                

             //  //console.log('precision', firstGeoObject.properties.get('metaDataProperty.GeocoderMetaData.precision'));
             //  hs = kind == "house" ? ++hs : hs;
             //  ss = kind == "street" ? ++ss : ss;
             //    //console.log("tmp ", tmp);
             //  /*
             //  * Область видимости и тип геообъекта => users[i].
             //  * Не знаю как сделать иначе без вызова сторонней функции
             //  */
             // console.log(hs); 

    return way; 
}
function translate_from_lat_lon_to_minutes(lon,lat) {
 // var lon = 24.72504500749274;
//     var lat = 58.74554729994484;

    var point = new GeoPoint(lon, lat);
return [point.getLonDeg(),point.getLatDeg()];
//     console.log(point.getLonDeg()); // 24° 43' 30.16"
//     console.log(point.getLatDeg()); // 58° 44' 43.97"
}


      function initMap() {

        var pos = { lat: 55.014690, lng: 82.959608 }
        var pos1 = { lat: 55.013232, lng: 82.947183 } 
        var opt = {
          center: pos,
          zoom: 15,
        }

        var FirstMap = new google.maps.Map(document.getElementById("map"), opt);

        let x;
        let y;
        let speed;
        var position;
        let markers = [];
        var types = {};
          x = randomInRange(55.015465, 55.012316);
          y = randomInRange(82.956089, 82.963985);
          speed = 0.00002;
          position = { lat: x, lng: y};




          var marker = new google.maps.Marker({
            position: position,
            map: FirstMap,
            title: "person",
            icon: 'https://img.icons8.com/plasticine/80/000000/person-laying-down.png'
           });

var lon = 24.72504500749274;
    var lat = 58.74554729994484;

    var point = new GeoPoint(lon, lat);

   // console.log(point.getLonDeg()); // 24° 43' 30.16"
   // console.log(point.getLatDeg()); // 58° 44' 43.97"


           
           var t=0;
           var temp ;
          var way_human;
           temp=translate_from_lat_lon_to_minutes(marker.getPosition().lat(), marker.getPosition().lng());
             console.log(temp);
           way_human = getMAP(temp);
           if (way_human == "street") {
           var interval =  setInterval(function() {
           
          //  console.log("tr\n");
            t++;
            if(t == 600){
             clearInterval(interval);
            } 
            let direction;

            for (var i = 0; i < 10; i++) {
             // types=components:route|type;
              direction = randomizeInteger(1,5);
            //  console.log("i: "+i+"\tdir:"+direction);
              changeMarkerPosition(marker, marker.getPosition().lat(), marker.getPosition().lng(), speed, direction);
             // getMAP(marker.getPosition().lat(), marker.getPosition().lng());
            }
          }, 100);
}

        // for (var i = 0; i < 10; i++) {
        //   
        //   x = randomInRange(55.015465, 55.012316);
        //   y = randomInRange(82.956089, 82.963985);
        //   speed = 0.003;
        //   position = { lat: x, lng: y};

        //   var marker = new google.maps.Marker({
        //     position: position,
        //     map: FirstMap,
        //     title: people[i],
        //     icon: 'https://img.icons8.com/plasticine/80/000000/person-laying-down.png'
        //    }); 
        //   markers.push(Item(marker, x, y, speed));
        // }
        // console.log(markers);





        //------------------------------------------------------------
        // var t = 0;
        // var interval =  setInterval(function() {
        //   console.log("tr\n");
        //   t++;
        //   if(t == 60){
        //     clearInterval(interval);
        //   }
        //  let direction;
        //   for (var i = 0; i < 10; i++) {
        //     direction = randomizeInteger(1,5);
        //     console.log("i: "+i+"\tdir:"+direction);
        //     changeMarkerPosition(markers[i].marker, markers[i].x, markers[i].y, markers[i].speed, direction);
        //   }
        //  }, 1000); //Every 1000ms = 1sec


       
      }


    </script>
  </head>
  <body>
    <div id="map"></div>
    <canvas id="example" width=" 200 " height="200">>
Этот текст отображается, если Ваш браузер не поддерживает HTML5 Canvas.
  </canvas>
  </body>
</html>