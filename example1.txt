<!DOCTYPE html>
<html>
  <head>
    <title>People&Roads</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
    <script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC6UyUT2h5LiCC2ClU7WUqoQSGq5EPQOSQ&callback=initMap&libraries=&v=weekly"
      defer
    ></script>
    <style type="text/css">
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 100%;
      }

      /* Optional: Makes the sample page fill the window. */
      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
    <script>
      const Struct = (...keys) => ((...v) => keys.reduce((o, k, i) => {o[k] = v[i]; return o} , {}))
      const Item = Struct('marker', 'x', 'y', 'speed')
      var people = [];


      function randomInRange(min, max) {
        return Math.random() < 0.5 ? ((1-Math.random()) * (max-min) + min) : (Math.random() * (max-min) + min);
      } 


      function randomizeInteger(min, max) {
      	if(max == null) {
    	    max = (min == null ? Number.MAX_SAFE_INTEGER : min);
      	  min = 0;
        }
        min = Math.ceil(min);  // inclusive min
        max = Math.floor(max); // exclusive max
  	    if(min > max - 1) {
    	    throw new Error("Incorrect arguments.");
        }
        return min + Math.floor((max - min) * Math.random());
      }


      function setNewPosition(marker, x, y){
        var latlng = new google.maps.LatLng(x, y);
        marker.setPosition(latlng);
      }


      function changeMarkerPosition(marker, x, y, speed, direction) {
        switch(direction){
          case 1: //right
            setNewPosition(marker, x+speed, y);
            break;
          case 2: //left
            setNewPosition(marker, x-speed, y);
            break;
          case 3: //up
            setNewPosition(marker, x, y+speed);
            break;
          case 4: //down
            setNewPosition(marker, x, y-speed);
            break;
        }
      }





      function initMap() {

        var pos = { lat: 55.014690, lng: 82.959608 }
        var pos1 = { lat: 55.013232, lng: 82.947183 } 
        var opt = {
          center: pos,
          zoom: 15,
        }

        var FirstMap = new google.maps.Map(document.getElementById("map"), opt);

        let x;
        let y;
        let speed;
        var position;
        let markers = [];

          x = randomInRange(55.015465, 55.012316);
          y = randomInRange(82.956089, 82.963985);
          speed = 0.00001;
          position = { lat: x, lng: y};




          var marker = new google.maps.Marker({
            position: position,
            map: FirstMap,
            title: "person",
            icon: 'https://img.icons8.com/plasticine/80/000000/person-laying-down.png'
           });



           
           var t=0;
           var interval =  setInterval(function() {
            console.log("tr\n");
            t++;
            if(t == 600){
             clearInterval(interval);
            } 
            let direction;
            for (var i = 0; i < 10; i++) {
              direction = randomizeInteger(1,5);
              console.log("i: "+i+"\tdir:"+direction);
              changeMarkerPosition(marker, marker.getPosition().lat(), marker.getPosition().lng(), speed, direction);
            }
          }, 100);


        // for (var i = 0; i < 10; i++) {
        //   
        //   x = randomInRange(55.015465, 55.012316);
        //   y = randomInRange(82.956089, 82.963985);
        //   speed = 0.003;
        //   position = { lat: x, lng: y};

        //   var marker = new google.maps.Marker({
        //     position: position,
        //     map: FirstMap,
        //     title: people[i],
        //     icon: 'https://img.icons8.com/plasticine/80/000000/person-laying-down.png'
        //    }); 
        //   markers.push(Item(marker, x, y, speed));
        // }
        // console.log(markers);





        //------------------------------------------------------------
        // var t = 0;
        // var interval =  setInterval(function() {
        //   console.log("tr\n");
        //   t++;
        //   if(t == 60){
        //     clearInterval(interval);
        //   }
        //  let direction;
        //   for (var i = 0; i < 10; i++) {
        //     direction = randomizeInteger(1,5);
        //     console.log("i: "+i+"\tdir:"+direction);
        //     changeMarkerPosition(markers[i].marker, markers[i].x, markers[i].y, markers[i].speed, direction);
        //   }
        //  }, 1000); //Every 1000ms = 1sec


       
      }


    </script>
  </head>
  <body>
    <div id="map"></div>
  </body>
</html>