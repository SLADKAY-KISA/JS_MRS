<!DOCTYPE html>
<html>
  <head>
    <title>People&Roads</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
    <script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC6UyUT2h5LiCC2ClU7WUqoQSGq5EPQOSQ&callback=initMap&libraries=&v=weekly"
      defer
    ></script>
    <style type="text/css">
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 100%;
      }

      /* Optional: Makes the sample page fill the window. */
      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
    <script>
      const Struct = (...keys) => ((...v) => keys.reduce((o, k, i) => {o[k] = v[i]; return o} , {}))
      const Item = Struct('marker', 'x', 'y', 'speed')
      var people = [];


      function randomInRange(min, max) {
        return Math.random() < 0.5 ? ((1-Math.random()) * (max-min) + min) : (Math.random() * (max-min) + min);
      } 


      function randomizeInteger(min, max) {
      	if(max == null) {
    	    max = (min == null ? Number.MAX_SAFE_INTEGER : min);
      	  min = 0;
        }
        min = Math.ceil(min);  // inclusive min
        max = Math.floor(max); // exclusive max
  	    if(min > max - 1) {
    	    throw new Error("Incorrect arguments.");
        }
        return min + Math.floor((max - min) * Math.random());
      }


      function setNewPosition(marker, x, y){
        var latlng = new google.maps.LatLng(x, y);
        marker.setPosition(latlng);
      }


      function changeMarkerPosition(marker, x, y, speed, direction) {
        switch(direction){
          case 1: //right
            setNewPosition(marker, x+speed, y);
            break;
          case 2: //left
            setNewPosition(marker, x-speed, y);
            break;
          case 3: //up
            setNewPosition(marker, x, y+speed);
            break;
          case 4: //down
            setNewPosition(marker, x, y-speed);
            break;
        }
      }





      function initMap() {

        var pos = { lat: 55.014690, lng: 82.959608 }
        var pos1 = { lat: 55.013232, lng: 82.947183 } 
        var opt = {
          center: pos,
          zoom: 15,
        }

        var FirstMap = new google.maps.Map(document.getElementById("map"), opt);

        let x;
        let y;
        let speed;
        var position;
        let markers = [];

          // x = randomInRange(55.015465, 55.012316);
          // y = randomInRange(82.956089, 82.963985);
          // speed1 = 0.00001;
          // position1 = { lat: x, lng: y};



        
          // var markerr = new google.maps.Marker({
          //   position: position1,
          //   map: FirstMap,
          //   title: "person",
          //   icon: 'https://img.icons8.com/plasticine/80/000000/person-laying-down.png'
          //  });
          //  let direction = 1;
          //  var t=0;
          //  var interval =  setInterval(function() {
          //   console.log("tr\n");
          //   t++;
          //   if(t == 300){
          //    clearInterval(interval);
          //   } 
            
          //   // for (var i = 0; i < 10; i++) {
          //     if(t % 30 == 0){
          //       direction = randomizeInteger(1,5);
          //     }
              
          //     console.log("i: "+i+"\tdir:"+direction);
          //     changeMarkerPosition(markerr, markerr.getPosition().lat(), markerr.getPosition().lng(), speed1, direction);
          //   // }
          // }, 100);
        

          NumberOfPeople = 20;

        for (var i = 0; i < NumberOfPeople; i++) {
          
          x = randomInRange(55.021465, 55.012316);
          y = randomInRange(82.936089, 82.963985);
          speed =  0.00006;
          position = { lat: x, lng: y};

          var marker = new google.maps.Marker({
            position: position,
            map: FirstMap,
            title: people[i],
            icon: 'https://img.icons8.com/plasticine/80/000000/person-laying-down.png'
           }); 
          markers.push(Item(marker, x, y, speed));
        }
        console.log(markers);











        let direction1 = [];
        for (var i = 0; i < NumberOfPeople; i++) {
          direction1.push(randomizeInteger(1,5));
        }
        var t1 = 0;
        console.log("DIRECTION1"+direction1);
        var interval1 =  setInterval(function() {
          console.log("tr\n");
          t1++;
          if(t1 == 400){
            clearInterval(interval1);
          }
          
          for (var i = 0; i < NumberOfPeople; i++) {
            if(t1 % 30 == 0){
                direction1[i] = randomizeInteger(1,5);
            }
            console.log("i: "+i+"\tdir:"+direction1[i]);
            changeMarkerPosition(markers[i].marker, markers[i].marker.getPosition().lat(), markers[i].marker.getPosition().lng(), markers[i].speed, direction1[i]);
          }
         }, 100); //Every 1000ms = 1sec


       
      }


    </script>
  </head>
  <body>
    <div id="map"></div>
  </body>
</html>